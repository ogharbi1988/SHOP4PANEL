<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SHOP 4 PANEL — Login Fix</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
:root{
  --bg1:#053642; /* bleu pétrole foncé */
  --bg2:#ff8a00; /* orange */
  --card:#ffffff;
  --muted:#6b7280;
  --turquoise:#00BFA6;
  --green:#32CD32;
  --orange:#FFB347;
  --glass: rgba(255,255,255,0.08);
  --radius:18px;
  --shadow: 0 12px 40px rgba(2,6,23,0.18);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
body{
  background: linear-gradient(135deg,var(--bg1) 10%, #0f4b57 40%, #2a7f78 60%, var(--bg2) 100%);
  display:flex;align-items:center;justify-content:center;min-height:100vh;color:#06121a;
}

/* centered login card */
.login-wrap{width:100%;max-width:980px;margin:24px;padding:22px;border-radius:20px;background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));backdrop-filter: blur(8px);box-shadow:var(--shadow);display:flex;gap:18px;align-items:stretch;}
.left{
  flex:1.1;background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));padding:28px;border-radius:14px;
  display:flex;flex-direction:column;justify-content:center;align-items:center;color:white;
}
.brand-logo{background:rgba(255,255,255,0.06);padding:12px 18px;border-radius:12px;font-weight:800;font-size:20px;display:inline-block;margin-bottom:12px}
.brand-sub{font-size:13px;opacity:0.9}
.hero-illus{width:100%;max-width:300px;margin-top:12px;opacity:0.95}
.right{flex:1;background:var(--card);border-radius:14px;padding:26px;box-shadow:0 8px 30px rgba(2,6,23,0.06)}

/* form styles */
.form-title{font-weight:800;margin-bottom:2px}
.form-sub{color:var(--muted);font-size:13px;margin-bottom:14px}
.input-group .form-control{border-radius:12px;padding:12px 14px;border:1px solid #e6eef4}
.input-icon{width:44px;display:flex;align-items:center;justify-content:center;background:linear-gradient(90deg,var(--turquoise),var(--green));color:white;border-radius:10px;margin-right:8px;height:44px}

/* buttons */
.btn-login{width:100%;background:linear-gradient(90deg,var(--turquoise),var(--green));border:none;color:white;padding:12px;border-radius:12px;font-weight:700;box-shadow:0 8px 22px rgba(2,6,23,0.08)}
.btn-secondary-soft{background:transparent;border:1px solid rgba(2,6,23,0.06);padding:10px;border-radius:10px}

/* dashboard layout (hidden until login) */
.app{display:none;min-height:100vh;width:100%;background:#f7fbfc;color:#07212a;padding:28px}
.top-bar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px}
.logo-small{font-weight:800;padding:8px 12px;border-radius:10px;background:linear-gradient(90deg,var(--turquoise),var(--orange));color:white}
.user-info{display:flex;gap:12px;align-items:center}
.avatar{width:48px;height:48px;border-radius:12px;background:linear-gradient(90deg,var(--turquoise),var(--green));display:flex;align-items:center;justify-content:center;color:white;font-weight:800}

/* tile buttons */
.tiles{display:flex;gap:12px;flex-wrap:wrap}
.tile{background:white;padding:14px;border-radius:12px;box-shadow:0 8px 24px rgba(2,6,23,0.06);flex:1;min-width:160px;cursor:pointer;display:flex;align-items:center;gap:12px;transition:transform .12s ease}
.tile:hover{transform:translateY(-6px)}
.tile .ico{width:44px;height:44;border-radius:10px;display:flex;align-items:center;justify-content:center;color:white}

/* pages */
.page{display:none;margin-top:12px}
.card{background:white;padding:14px;border-radius:12px;box-shadow:0 8px 24px rgba(2,6,23,0.04)}

/* marquee */
.marquee{background:linear-gradient(90deg, rgba(255,255,255,0.95), rgba(255,255,255,0.9));padding:8px 12px;border-radius:8px;margin-bottom:12px;overflow:hidden;white-space:nowrap}
.marquee span{display:inline-block;padding-left:100%;animation:marq 16s linear infinite}
@keyframes marq{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}

/* responsive */
@media (max-width:900px){
  .login-wrap{flex-direction:column;padding:18px}
  .left{order:2}
  .right{order:1}
  .tiles{flex-direction:column}
}
</style>
</head>
<body>

<!-- Centered login + dashboard container -->
<div id="root-container" style="width:100%;max-width:1100px;padding:18px">
  <!-- Login card -->
  <div class="login-wrap" id="login-wrap">
    <div class="left">
      <div class="brand-logo">SHOP 4 PANEL</div>
      <div class="brand-sub">Nouvelle Génération &amp; Smart</div>
      <img src="https://i.imgur.com/6YVd6QJ.png" alt="ill" class="hero-illus" style="max-width:280px">
    </div>

    <div class="right">
      <div class="form-title">Se connecter</div>
      <div class="form-sub">Connectez-vous avec votre compte</div>

      <form id="login-form" style="display:flex;flex-direction:column;gap:12px">
        <div style="display:flex;gap:8px;align-items:center">
          <div class="input-icon"><i class="fa fa-envelope"></i></div>
          <input id="email" type="email" placeholder="Email" class="form-control" required>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <div class="input-icon"><i class="fa fa-lock"></i></div>
          <input id="password" type="password" placeholder="Mot de passe" class="form-control" required>
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><input id="remember" type="checkbox"> <label for="remember">Se souvenir</label></div>
          <div><a href="#" id="forgot" style="color:var(--turquoise);text-decoration:none;font-weight:600">Mot de passe oublié ?</a></div>
        </div>

        <div id="login-error" style="color:#b00020;font-weight:700;display:none"></div>

        <button type="submit" class="btn-login">Se connecter</button>
        <div style="display:flex;gap:8px;justify-content:space-between;margin-top:6px">
          <button type="button" class="btn-secondary-soft" id="demo-admin">Admin demo</button>
          <button type="button" class="btn-secondary-soft" id="demo-user">User demo</button>
        </div>

        <div style="margin-top:10px;font-size:13px;color:#334155">Identifiants : <strong>ogharbi1988@shop4panel.com / admin1988</strong> (admin) — <strong>user@shop4panel.com / admin1988</strong> (user)</div>
      </form>
    </div>
  </div>

  <!-- App / dashboard (hidden initially) -->
  <div class="app" id="app" style="display:none">
    <div class="top-bar">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="logo-small">SHOP 4 PANEL</div>
        <div>
          <div style="font-weight:700" id="hdr-welcome">Tableau de bord</div>
          <div style="font-size:13px;color:var(--muted)">Interface moderne</div>
        </div>
      </div>
      <div class="user-info">
        <div style="text-align:right;margin-right:8px">
          <div id="hdr-name" style="font-weight:700">Invité</div>
          <div id="hdr-role" style="font-size:13px;color:var(--muted)">Non connecté</div>
        </div>
        <div class="avatar" id="hdr-avatar">S4</div>
      </div>
    </div>

    <!-- Marquee bilingual in top of dashboard -->
    <div class="marquee card" id="marquee"><span>⚠️ Le montant minimum pour la recharge est de 500 DH — الحد الأدنى لإعادة الشحن هو 500 درهم &nbsp;&nbsp;&nbsp;</span></div>

    <!-- Tiles/buttons -->
    <div class="tiles">
      <div class="tile" data-page="dashboard-home"><div class="ico turq" style="background:linear-gradient(90deg,var(--turquoise),var(--green))"><i class="fas fa-home"></i></div><div><strong>Tableau de bord</strong><div class="muted">Vue générale</div></div></div>
      <div class="tile" data-page="products"><div class="ico green" style="background:linear-gradient(90deg,var(--green),var(--turquoise))"><i class="fas fa-box-open"></i></div><div><strong>Produits</strong><div class="muted">Catalogue & achats</div></div></div>
      <div class="tile" data-page="balance"><div class="ico orange" style="background:linear-gradient(90deg,var(--orange),var(--turquoise))"><i class="fas fa-wallet"></i></div><div><strong>Mon solde</strong><div class="muted">Recharges</div></div></div>
      <div class="tile" data-page="tickets"><div class="ico turq" style="background:linear-gradient(90deg,var(--turquoise),var(--orange))"><i class="fas fa-ticket-alt"></i></div><div><strong>Tickets</strong><div class="muted">Support</div></div></div>
      <div class="tile" data-page="generator"><div class="ico green" style="background:linear-gradient(90deg,var(--green),var(--orange))"><i class="fas fa-key"></i></div><div><strong>Générateur</strong><div class="muted">Codes & licences</div></div></div>
      <div class="tile" id="admin-tile" data-page="admin" style="display:none"><div class="ico orange" style="background:linear-gradient(90deg,var(--turquoise),var(--orange))"><i class="fas fa-cogs"></i></div><div><strong>Administration</strong><div class="muted">Utilisateurs & produits</div></div></div>
      <div class="tile" id="logout-tile" style="display:none"><div class="ico" style="background:#94a3b8"><i class="fas fa-sign-out-alt"></i></div><div><strong>Déconnexion</strong><div class="muted">Se déconnecter</div></div></div>
    </div>

    <!-- Pages content -->
    <div id="dashboard-home" class="page card" style="display:block;margin-top:12px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h4 style="margin:0">Bonjour, <span id="user-greet">Invité</span></h4>
          <div class="muted">Aperçu des activités</div>
        </div>
        <div class="muted">Connecté depuis: <strong id="session-duration">—</strong></div>
      </div>

      <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
        <div class="card" style="flex:1;min-width:220px">
          <div class="muted">Solde actuel</div>
          <div style="font-weight:800;font-size:20px" id="user-balance">0.00 MAD</div>
        </div>
        <div class="card" style="flex:1;min-width:220px">
          <div class="muted">Produits disponibles</div>
          <div style="font-weight:800;font-size:20px" id="products-count">0</div>
        </div>
        <div class="card" style="flex:1;min-width:220px">
          <div class="muted">Tickets ouverts</div>
          <div style="font-weight:800;font-size:20px">0</div>
        </div>
      </div>
    </div>

    <div id="products" class="page card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h4 style="margin:0">Produits</h4>
        <div class="muted">Total: <span id="products-count-2">0</span></div>
      </div>
      <div id="products-container" style="margin-top:12px;display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px"></div>
    </div>

    <div id="balance" class="page card" style="display:none">
      <h4>Mon solde</h4>
      <div style="margin-top:8px"><div class="muted">Solde actuel</div><div id="current-balance" style="font-weight:800">0.00 MAD</div></div>
      <div style="margin-top:12px"><button class="btn-login" id="open-recharge-small" style="width:auto;background:linear-gradient(90deg,var(--orange),var(--turquoise))">Demander une recharge</button></div>
    </div>

    <div id="tickets" class="page card" style="display:none">
      <h4>Tickets</h4>
      <div class="muted">Envoyer une demande au support</div>
      <div style="margin-top:12px"><button class="btn-login" id="new-ticket-small" style="width:auto;background:linear-gradient(90deg,var(--turquoise),var(--green))">Nouveau ticket</button></div>
    </div>

    <div id="generator" class="page card" style="display:none">
      <h4>Générateur</h4>
      <div class="muted">Générer des codes (admin seulement)</div>
      <form id="gen-form" style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
        <select id="product-select" class="form-control" style="flex:1 1 200px"><option value="">Choisir un produit</option></select>
        <input id="gen-qty" class="form-control" type="number" min="1" value="1" style="width:120px">
        <button class="btn-login" type="submit" style="width:auto">Générer</button>
      </form>
      <div id="generated" style="margin-top:12px"></div>
    </div>

    <div id="admin" class="page card" style="display:none">
      <h4>Administration</h4>
      <div class="muted">Gestion des utilisateurs</div>
      <div style="margin-top:12px;overflow:auto">
        <table style="width:100%;border-collapse:collapse">
          <thead><tr style="text-align:left"><th>Nom</th><th>Email</th><th>Rôle</th><th>Dernière connexion</th><th>Durée connectée</th><th>Solde</th></tr></thead>
          <tbody id="admin-users-table"></tbody>
        </table>
      </div>
      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn-login" id="btn-add-user" style="width:auto;background:linear-gradient(90deg,var(--turquoise),var(--green))">Ajouter utilisateur</button>
        <button class="btn-login" id="btn-add-product" style="width:auto;background:linear-gradient(90deg,var(--orange),var(--turquoise))">Ajouter produit</button>
      </div>
    </div>

  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
// Data
const products = [
  {id:1,name:"LPTV M3U 12 Mois",price:350,stock:10,category:"M3U"},
  {id:2,name:"CODE HTV 6 Mois",price:250,stock:12,category:"CODE"},
  {id:3,name:"Test 24h",price:0,stock:50,category:"TEST"}
];

const users = [
  {id:1,name:"Admin Ogharbi",email:"ogharbi1988@shop4panel.com",password:"admin1988",role:"admin",balance:1500,lastLogin:null,sessionStart:null,isOnline:false},
  {id:2,name:"User Demo",email:"user@shop4panel.com",password:"admin1988",role:"user",balance:500,lastLogin:null,sessionStart:null,isOnline:false},
  {id:3,name:"Test User",email:"test@shop4panel.com",password:"test123",role:"test",balance:0,lastLogin:null,sessionStart:null,isOnline:false}
];

let currentUser = null;
let sessionInterval = null;

// helpers
function showLoginError(msg){ $('#login-error').text(msg).show(); setTimeout(()=>$('#login-error').fadeOut(300),5000); }
function formatDuration(ms){ if(!ms) return '-'; const s=Math.floor(ms/1000), h=Math.floor(s/3600), m=Math.floor((s%3600)/60), sec=s%60; return `${h}h ${m}m ${sec}s`; }
function fmt(dt){ if(!dt) return 'Jamais'; return (new Date(dt)).toLocaleString('fr-FR'); }

// render products
function renderProducts(){
  $('#products-container').empty();
  products.forEach(p=>{
    const card = $(\`<div class="card" style="padding:12px"><div style="display:flex;gap:12px;align-items:center"><div style="width:64px;height:64px;border-radius:10px;background:linear-gradient(90deg,var(--turquoise),var(--green));color:white;display:flex;align-items:center;justify-content:center;font-weight:700">\${p.name.split(' ')[0]}</div><div style="flex:1"><strong>\${p.name}</strong><div class="muted">\${p.category} • Stock: \${p.stock}</div></div><div><div style="font-weight:700">\${p.price>0?p.price.toFixed(2)+' MAD':'GRATUIT'}</div><div style="margin-top:8px"><button class="btn-login buy" data-id="\${p.id}" style="background:linear-gradient(90deg,var(--turquoise),var(--green));width:100px">Acheter</button></div></div></div></div>\`);
    $('#products-container').append(card);
  });
  $('#products-count').text(products.length);
  $('#products-count-2').text(products.length);
  $('#product-select').empty().append('<option value="">Choisir un produit</option>');
  products.forEach(p=>$('#product-select').append('<option value="'+p.id+'">'+p.name+'</option>'));
}

// admin users table update
function updateAdminTable(){
  $('#admin-users-table').empty();
  users.forEach(u=>{
    const dur = u.isOnline && u.sessionStart ? formatDuration(Date.now()-u.sessionStart) : '-';
    $('#admin-users-table').append('<tr><td>'+u.name+'</td><td>'+u.email+'</td><td>'+u.role+'</td><td>'+fmt(u.lastLogin)+'</td><td>'+dur+'</td><td>'+u.balance.toFixed(2)+' MAD</td></tr>');
  });
}

// login submit
$('#login-form').on('submit', function(e){
  e.preventDefault();
  const email = $('#email').val().trim(), pwd = $('#password').val().trim();
  if(!email || !pwd){ showLoginError('Email et mot de passe requis'); return; }
  const user = users.find(u=>u.email===email && u.password===pwd);
  if(!user){ showLoginError('Email ou mot de passe incorrect'); return; }
  // reset other sessions as requested (reset on each new login)
  users.forEach(u=>{ u.isOnline=false; u.sessionStart=null; });
  user.lastLogin = new Date().toISOString();
  user.sessionStart = Date.now();
  user.isOnline = true;
  currentUser = user;
  // update header
  $('#hdr-name').text(currentUser.name); $('#hdr-role').text(currentUser.role==='admin'?'Administrateur':(currentUser.role==='test'?'Utilisateur test':'Utilisateur')); $('#hdr-avatar').text(currentUser.name.split(' ').map(x=>x[0]).join('').slice(0,2).toUpperCase());
  $('#user-greet').text(currentUser.name);
  $('#user-balance, #current-balance').text(currentUser.balance.toFixed(2)+' MAD');
  // show app
  $('#login-wrap').hide();
  $('#app').show();
  // show admin tile only for admin role
  if(currentUser.role==='admin'){ $('#admin-tile').show(); $('#logout-tile').show(); } else { $('#admin-tile').hide(); $('#logout-tile').show(); }
  renderProducts();
  updateAdminTable();
  // start session timer update
  if(sessionInterval) clearInterval(sessionInterval);
  sessionInterval = setInterval(()=>{
    if(currentUser && currentUser.sessionStart) $('#session-duration').text(formatDuration(Date.now()-currentUser.sessionStart));
    updateAdminTable();
  },1000);
});

// demo buttons prefill
$('#demo-admin').on('click', function(){ $('#email').val('ogharbi1988@shop4panel.com'); $('#password').val('admin1988'); });
$('#demo-user').on('click', function(){ $('#email').val('user@shop4panel.com'); $('#password').val('admin1988'); });

// tiles navigation
$(document).on('click', '.tile', function(){
  const page = $(this).data('page');
  if(!page) return;
  // admin access check
  if(page==='admin' && (!currentUser || currentUser.role!=='admin')){ showLoginError('Accès administration réservé aux administrateurs'); return; }
  $('.page').hide();
  $('#'+page).show();
});

// logout tile
$('#logout-tile').on('click', function(){ if(currentUser){ currentUser.isOnline=false; currentUser.sessionStart=null; } currentUser=null; if(sessionInterval) clearInterval(sessionInterval); $('#app').hide(); $('#login-wrap').show(); $('#email,#password').val(''); $('#hdr-name').text('Invité'); $('#hdr-role').text('Non connecté'); $('#hdr-avatar').text('S4'); showLoginError('Déconnecté'); });

// buy product
$(document).on('click', '.buy', function(){
  const id = $(this).data('id'); const p = products.find(x=>x.id==id);
  if(!currentUser){ showLoginError('Veuillez vous connecter pour acheter'); return; }
  if(currentUser.balance >= p.price){
    currentUser.balance -= p.price; p.stock = Math.max(0,p.stock-1);
    $('#user-balance, #current-balance').text(currentUser.balance.toFixed(2)+' MAD');
    renderProducts(); updateAdminTable(); showLoginError('Achat réussi: '+p.name);
  } else showLoginError('Solde insuffisant');
});

// recharge simple prompt
$('#open-recharge-small').on('click', function(){
  if(!currentUser){ showLoginError('Connectez-vous d\'abord'); return; }
  const amt = prompt('Montant recharge (min 500)'); const n = parseFloat(amt||0);
  if(isNaN(n) || n<500){ showLoginError('Montant invalide (min 500)'); return; }
  currentUser.balance += n; $('#user-balance, #current-balance').text(currentUser.balance.toFixed(2)+' MAD'); updateAdminTable(); showLoginError('Recharge ajoutée: '+n+' MAD');
});

// generator (admin only)
$('#gen-form').on('submit', function(e){
  e.preventDefault();
  if(!currentUser || currentUser.role!=='admin'){ showLoginError('Accès réservé aux administrateurs'); return; }
  const pid = $('#product-select').val(); const qty = parseInt($('#gen-qty').val())||1;
  if(!pid){ showLoginError('Choisir un produit'); return; }
  let codes=''; for(let i=0;i<qty;i++){ codes += 'CODE-'+Math.random().toString(36).slice(2,10).toUpperCase()+'<br>'; }
  $('#generated').html('<div class="card"><strong>Codes générés:</strong><div style="margin-top:8px">'+codes+'</div></div>');
});

// add user (admin only)
$('#btn-add-user').on('click', function(){
  if(!currentUser || currentUser.role!=='admin'){ showLoginError('Accès réservé aux administrateurs'); return; }
  const name = prompt('Nom complet'); if(!name) return; const email = prompt('Email'); if(!email) return; const pwd = prompt('Mot de passe'); if(!pwd) return;
  const role = prompt('Rôle (user/test/admin)','user'); const bal = parseFloat(prompt('Solde initial (MAD)','0'))||0;
  const id = users.length+1; users.push({id,name,email,password:pwd,role,balance:bal,lastLogin:null,sessionStart:null,isOnline:false}); updateAdminTable(); showLoginError('Utilisateur ajouté');
});

// add product (admin only)
$('#btn-add-product').on('click', function(){
  if(!currentUser || currentUser.role!=='admin'){ showLoginError('Accès réservé aux administrateurs'); return; }
  const name = prompt('Nom produit'); if(!name) return; const price = parseFloat(prompt('Prix (MAD)','0'))||0; const cat = prompt('Catégorie','M3U');
  const id = products.length+1; products.push({id,name,price,stock:10,category:cat}); renderProducts(); showLoginError('Produit ajouté');
});

// init render
renderProducts(); updateAdminTable();
</script>
</body>
</html>
