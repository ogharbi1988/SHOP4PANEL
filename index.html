<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SHOP 4 PANEL — V6 PRO</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

<style>
:root {
  --bg-a: #05292d; 
  --accent1: #00bfa6; 
  --accent2: #10b981; 
  --accent3: #ff8a00;
  --accent4: #6366f1;
  --card-radius: 20px; 
  --shadow: 0 25px 60px rgba(2,6,23,0.15);
  --shadow-light: 0 15px 40px rgba(2,6,23,0.08);
  --muted: #7b8890;
  --gradient-primary: linear-gradient(135deg, var(--accent1), var(--accent4));
  --gradient-secondary: linear-gradient(135deg, var(--accent2), var(--accent3));
}

* {
  box-sizing: border-box; 
  margin: 0; 
  padding: 0;
}

html, body {
  height: 100%; 
  font-family: 'Public Sans', Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
}

body {
  background: linear-gradient(135deg, var(--bg-a), #0b3940 40%, #0f6e6a 70%, var(--accent3)); 
  color: #03121a;
  overflow-x: hidden;
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
}

@keyframes slideIn {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes glow {
  0%, 100% { box-shadow: 0 0 20px rgba(0,191,166,0.3); }
  50% { box-shadow: 0 0 30px rgba(0,191,166,0.6); }
}

/* Layout principal */
.container-center {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 28px;
  position: relative;
  z-index: 2;
}

/* Effets de fond animés */
.background-effects {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
  overflow: hidden;
}

.floating-shape {
  position: absolute;
  border-radius: 50%;
  background: linear-gradient(45deg, var(--accent1), transparent);
  animation: float 6s ease-in-out infinite;
}

.shape-1 { width: 200px; height: 200px; top: 10%; left: 5%; animation-delay: 0s; }
.shape-2 { width: 150px; height: 150px; top: 60%; right: 10%; animation-delay: 2s; }
.shape-3 { width: 100px; height: 100px; bottom: 20%; left: 20%; animation-delay: 4s; }

/* Carte de connexion moderne */
.loginCard {
  width: 100%;
  max-width: 420px;
  border-radius: var(--card-radius);
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  box-shadow: var(--shadow);
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.2);
  animation: slideIn 0.8s ease-out;
  position: relative;
  z-index: 10;
}

.loginHeader {
  background: var(--gradient-primary);
  padding: 30px;
  text-align: center;
  color: white;
  position: relative;
}

.logoBadge {
  width: 80px;
  height: 80px;
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.2);
  color: white;
  font-weight: 900;
  font-size: 24px;
  margin: 0 auto 15px;
  backdrop-filter: blur(10px);
  border: 2px solid rgba(255, 255, 255, 0.3);
}

.logoTitle {
  font-size: 24px;
  font-weight: 900;
  margin-bottom: 8px;
}

.slogan {
  font-size: 14px;
  opacity: 0.9;
  font-weight: 500;
}

/* Formulaire */
.form {
  padding: 30px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.field {
  position: relative;
}

.field input, .field select {
  width: 100%;
  padding: 16px 16px 16px 50px;
  border-radius: 12px;
  border: 2px solid #f0f0f0;
  background: white;
  font-size: 15px;
  outline: none;
  transition: all 0.3s ease;
  font-family: 'Public Sans', sans-serif;
}

.field input:focus, .field select:focus {
  border-color: var(--accent1);
  box-shadow: 0 0 0 3px rgba(0, 191, 166, 0.1);
  transform: translateY(-2px);
}

.icon {
  position: absolute;
  left: 16px;
  top: 50%;
  transform: translateY(-50%);
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--accent1);
  z-index: 2;
}

/* Boutons */
.btnPrimary {
  padding: 16px;
  border-radius: 12px;
  border: none;
  background: var(--gradient-primary);
  color: white;
  font-weight: 700;
  cursor: pointer;
  box-shadow: var(--shadow-light);
  transition: all 0.3s ease;
  font-family: 'Public Sans', sans-serif;
  font-size: 15px;
}

.btnPrimary:hover {
  transform: translateY(-2px);
  box-shadow: 0 15px 30px rgba(0, 191, 166, 0.3);
  animation: glow 2s infinite;
}

.btnSecondary {
  padding: 12px 20px;
  border-radius: 10px;
  border: 2px solid var(--accent1);
  background: transparent;
  color: var(--accent1);
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btnSecondary:hover {
  background: var(--accent1);
  color: white;
  transform: translateY(-2px);
}

/* App Layout */
.app {
  display: none;
  min-height: 100vh;
  background: #f8fafc;
}

.topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 30px;
  background: white;
  box-shadow: 0 2px 20px rgba(2,6,23,0.08);
  position: sticky;
  top: 0;
  z-index: 100;
}

.brand {
  font-weight: 800;
  padding: 10px 20px;
  border-radius: 12px;
  background: var(--gradient-primary);
  color: white;
  font-size: 18px;
}

.user-menu {
  display: flex;
  align-items: center;
  gap: 15px;
}

.notification-badge {
  position: absolute;
  top: -5px;
  right: -5px;
  background: #ff4757;
  color: white;
  border-radius: 50%;
  width: 18px;
  height: 18px;
  font-size: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.user-avatar {
  width: 45px;
  height: 45px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 800;
  background: var(--gradient-secondary);
}

/* Sidebar moderne */
.sidebar {
  width: 280px;
  background: white;
  box-shadow: 2px 0 20px rgba(2,6,23,0.08);
  padding: 25px;
  height: calc(100vh - 70px);
  position: fixed;
  overflow-y: auto;
}

.menu {
  margin-top: 25px;
}

.menu .item {
  padding: 14px 16px;
  border-radius: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 8px;
  transition: all 0.3s ease;
  color: #64748b;
  font-weight: 500;
}

.menu .item:hover, .menu .item.active {
  background: var(--gradient-primary);
  color: white;
  transform: translateX(5px);
}

.menu .item i {
  width: 20px;
  text-align: center;
}

/* Contenu principal */
.content {
  flex: 1;
  padding: 30px;
  margin-left: 280px;
  background: #f8fafc;
  min-height: calc(100vh - 70px);
}

/* Grille de statistiques */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
  margin: 25px 0;
}

.stat-card {
  background: white;
  border-radius: var(--card-radius);
  padding: 25px;
  box-shadow: var(--shadow-light);
  text-align: center;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--gradient-primary);
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow);
}

.stat-value {
  font-size: 32px;
  font-weight: 800;
  margin: 10px 0;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.stat-label {
  font-size: 14px;
  color: var(--muted);
  font-weight: 500;
}

/* Produits */
.products-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.product-card {
  background: white;
  border-radius: var(--card-radius);
  padding: 20px;
  box-shadow: var(--shadow-light);
  transition: all 0.3s ease;
  position: relative;
}

.product-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow);
}

.product-image {
  width: 100%;
  height: 160px;
  border-radius: 12px;
  object-fit: cover;
  margin-bottom: 15px;
  background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
}

.product-price {
  font-size: 24px;
  font-weight: 800;
  color: var(--accent1);
  margin: 10px 0;
}

/* Modals */
.modal {
  display: none;
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(2,6,23,0.6);
  align-items: center;
  justify-content: center;
  z-index: 1000;
  backdrop-filter: blur(5px);
}

.modal .modalInner {
  background: white;
  padding: 30px;
  border-radius: var(--card-radius);
  min-width: 400px;
  max-width: 90vw;
  max-height: 90vh;
  overflow-y: auto;
  animation: slideIn 0.3s ease;
  box-shadow: var(--shadow);
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #374151;
}

.form-group input, .form-group select, .form-group textarea {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e5e7eb;
  border-radius: 10px;
  font-size: 15px;
  transition: all 0.3s ease;
  font-family: 'Public Sans', sans-serif;
}

.form-group input:focus, .form-group select:focus {
  border-color: var(--accent1);
  box-shadow: 0 0 0 3px rgba(0, 191, 166, 0.1);
}

/* Tableaux */
.data-table {
  background: white;
  border-radius: var(--card-radius);
  overflow: hidden;
  box-shadow: var(--shadow-light);
  margin-top: 20px;
}

.table-header {
  padding: 20px;
  background: var(--gradient-primary);
  color: white;
  font-weight: 700;
  font-size: 18px;
}

.table-content {
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 15px 20px;
  text-align: left;
  border-bottom: 1px solid #f1f5f9;
}

th {
  background: #f8fafc;
  font-weight: 600;
  color: #475569;
}

tr:hover {
  background: #f8fafc;
}

/* Responsive */
@media (max-width: 1024px) {
  .sidebar {
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    z-index: 99;
  }
  
  .sidebar.active {
    transform: translateX(0);
  }
  
  .content {
    margin-left: 0;
  }
  
  .menu-toggle {
    display: block !important;
  }
}

@media (max-width: 768px) {
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .products-grid {
    grid-template-columns: 1fr;
  }
  
  .topbar {
    padding: 15px 20px;
  }
  
  .content {
    padding: 20px;
  }
  
  .modal .modalInner {
    min-width: 90%;
    margin: 20px;
  }
}

.menu-toggle {
  display: none;
  background: none;
  border: none;
  font-size: 24px;
  color: var(--accent1);
  cursor: pointer;
}

/* Badges */
.badge {
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.badge-success {
  background: #dcfce7;
  color: #166534;
}

.badge-warning {
  background: #fef3c7;
  color: #92400e;
}

.badge-danger {
  background: #fee2e2;
  color: #991b1b;
}

/* Utilitaires */
.text-success { color: #10b981; }
.text-danger { color: #ef4444; }
.text-warning { color: #f59e0b; }

.loading {
  opacity: 0.6;
  pointer-events: none;
}

.hidden {
  display: none !important;
}
</style>
</head>
<body>
<!-- Effets de fond -->
<div class="background-effects">
  <div class="floating-shape shape-1"></div>
  <div class="floating-shape shape-2"></div>
  <div class="floating-shape shape-3"></div>
</div>

<!-- PAGE DE CONNEXION -->
<div class="container-center" id="loginView">
  <div class="loginCard">
    <div class="loginHeader">
      <div class="logoBadge">S4</div>
      <div class="logoTitle">SHOP 4 PANEL PRO</div>
      <div class="slogan">Système de gestion nouvelle génération</div>
    </div>
    
    <form id="loginForm" class="form" autocomplete="on" novalidate>
      <div class="field">
        <div class="icon"><i class="fa fa-user"></i></div>
        <select id="userType" required>
          <option value="">Type d'utilisateur</option>
          <option value="admin">Administrateur</option>
          <option value="user">Utilisateur</option>
        </select>
      </div>
      
      <div class="field">
        <div class="icon"><i class="fa fa-envelope"></i></div>
        <input id="email" type="email" placeholder="Email" required>
      </div>
      
      <div class="field">
        <div class="icon"><i class="fa fa-lock"></i></div>
        <input id="password" type="password" placeholder="Mot de passe" required>
      </div>
      
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <label style="display: flex; align-items: center; gap: 8px;">
          <input id="remember" type="checkbox"> Se souvenir
        </label>
        <div>
          <a href="#" id="langFR">FR</a> · <a href="#" id="langAR">AR</a>
        </div>
      </div>
      
      <div id="loginErr" class="msg err" role="alert"></div>
      
      <button type="submit" class="btnPrimary" id="btnLogin">
        <i class="fa fa-sign-in-alt"></i> Se connecter
      </button>
      
      <div style="display: flex; gap: 10px; margin-top: 15px;">
        <button type="button" class="btnSecondary" id="demoAdmin">
          <i class="fa fa-crown"></i> Admin demo
        </button>
        <button type="button" class="btnSecondary" id="demoUser">
          <i class="fa fa-user"></i> User demo
        </button>
      </div>
      
      <div style="margin-top: 20px; font-size: 12px; color: var(--muted); text-align: center;">
        <div><strong>Admin:</strong> admin@shop4panel.com / admin123</div>
        <div><strong>User:</strong> user@shop4panel.com / user123</div>
      </div>
    </form>
  </div>
</div>

<!-- APPLICATION PRINCIPALE -->
<div class="app" id="app">
  <!-- Topbar -->
  <div class="topbar">
    <div style="display: flex; align-items: center; gap: 15px;">
      <button class="menu-toggle" id="menuToggle">
        <i class="fa fa-bars"></i>
      </button>
      <div class="brand">SHOP 4 PANEL PRO</div>
    </div>
    
    <div class="user-menu">
      <div style="position: relative; cursor: pointer;" id="notificationsBtn">
        <i class="fa fa-bell" style="font-size: 20px; color: var(--accent1);"></i>
        <span class="notification-badge" id="notificationCount">3</span>
      </div>
      
      <div id="userInfo" style="text-align: right;">
        <div id="uName" style="font-weight: 700;">Invité</div>
        <div id="uRole" style="font-size: 12px; color: var(--muted);">Non connecté</div>
      </div>
      
      <div class="user-avatar" id="uAvatar">S4</div>
    </div>
  </div>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="menu">
      <div class="item active" data-page="dashboard">
        <i class="fa fa-chart-line"></i> Tableau de bord
      </div>
      <div class="item" data-page="products">
        <i class="fa fa-boxes"></i> Produits
      </div>
      <div class="item" data-page="balance">
        <i class="fa fa-wallet"></i> Mon solde
      </div>
      <div class="item" data-page="users" id="usersMenu" style="display: none;">
        <i class="fa fa-users"></i> Gestion utilisateurs
      </div>
      <div class="item" data-page="history">
        <i class="fa fa-history"></i> Historique
      </div>
      <div class="item" data-page="settings">
        <i class="fa fa-cog"></i> Paramètres
      </div>
    </div>
    
    <div style="margin-top: 30px; padding: 20px; background: #f8fafc; border-radius: 12px;">
      <button id="logoutBtn" class="btnPrimary" style="width: 100%;">
        <i class="fa fa-sign-out-alt"></i> Déconnexion
      </button>
    </div>
  </aside>

  <!-- Contenu principal -->
  <main class="content" id="content">
    <!-- Tableau de bord -->
    <section id="dashboard" class="page">
      <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
        <div>
          <h2 style="margin: 0;">Tableau de bord</h2>
          <div style="color: var(--muted);">Vue d'ensemble de votre activité</div>
        </div>
        <div id="adminStats" style="display: none;">
          <span class="badge badge-success" id="onlineUsers">0 utilisateurs en ligne</span>
        </div>
      </div>

      <!-- Statistiques -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Solde actuel</div>
          <div class="stat-value" id="userBalance">0.00 MAD</div>
          <div style="font-size: 12px; color: var(--muted);">Disponible</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-label">Produits en stock</div>
          <div class="stat-value" id="totalProducts">0</div>
          <div style="font-size: 12px; color: var(--muted);">Total produits</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-label">Ventes du mois</div>
          <div class="stat-value" id="monthlySales">0</div>
          <div style="font-size: 12px; color: var(--muted);">Ce mois-ci</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-label">Utilisateurs</div>
          <div class="stat-value" id="totalUsers">0</div>
          <div style="font-size: 12px; color: var(--muted);">Total inscrits</div>
        </div>
      </div>

      <!-- Graphique et activité récente -->
      <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 25px; margin-top: 30px;">
        <div style="background: white; padding: 25px; border-radius: var(--card-radius); box-shadow: var(--shadow-light);">
          <h3 style="margin-bottom: 20px;">Activité des ventes</h3>
          <canvas id="salesChart" height="250"></canvas>
        </div>
        
        <div style="background: white; padding: 25px; border-radius: var(--card-radius); box-shadow: var(--shadow-light);">
          <h3 style="margin-bottom: 20px;">Activité récente</h3>
          <div id="recentActivity" style="max-height: 300px; overflow-y: auto;">
            <!-- Activité récente -->
          </div>
        </div>
      </div>
    </section>

    <!-- Page Produits -->
    <section id="products" class="page hidden">
      <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 25px;">
        <div>
          <h2 style="margin: 0;">Gestion des produits</h2>
          <div style="color: var(--muted);">Ajouter et gérer vos produits</div>
        </div>
        <button class="btnPrimary" id="addProductBtn">
          <i class="fa fa-plus"></i> Nouveau produit
        </button>
      </div>

      <div class="products-grid" id="productsGrid">
        <!-- Produits chargés dynamiquement -->
      </div>
    </section>

    <!-- Page Utilisateurs (Admin seulement) -->
    <section id="users" class="page hidden">
      <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 25px;">
        <div>
          <h2 style="margin: 0;">Gestion des utilisateurs</h2>
          <div style="color: var(--muted);">Gérer les comptes utilisateurs</div>
        </div>
        <button class="btnPrimary" id="addUserBtn">
          <i class="fa fa-user-plus"></i> Nouvel utilisateur
        </button>
      </div>

      <div class="data-table">
        <div class="table-header">Liste des utilisateurs</div>
        <div class="table-content">
          <table>
            <thead>
              <tr>
                <th>Nom</th>
                <th>Email</th>
                <th>Rôle</th>
                <th>Solde</th>
                <th>Statut</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="usersTable">
              <!-- Utilisateurs chargés dynamiquement -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Autres pages (solde, historique, paramètres) -->
    <section id="balance" class="page hidden">
      <h2>Mon solde</h2>
      <!-- Contenu solde -->
    </section>

    <section id="history" class="page hidden">
      <h2>Historique</h2>
      <!-- Contenu historique -->
    </section>

    <section id="settings" class="page hidden">
      <h2>Paramètres</h2>
      <!-- Contenu paramètres -->
    </section>
  </main>
</div>

<!-- MODALS -->

<!-- Modal Ajouter Produit -->
<div class="modal" id="addProductModal">
  <div class="modalInner">
    <h3 style="margin-bottom: 20px;">Ajouter un produit</h3>
    <form id="addProductForm">
      <div class="form-group">
        <label>Nom du produit</label>
        <input type="text" id="productName" required placeholder="Ex: Abonnement VIP 12 mois">
      </div>
      
      <div class="form-group">
        <label>Prix (MAD)</label>
        <input type="number" id="productPrice" required min="0" step="0.01" placeholder="0.00">
      </div>
      
      <div class="form-group">
        <label>Quantité en stock</label>
        <input type="number" id="productStock" required min="0" placeholder="0">
      </div>
      
      <div class="form-group">
        <label>Catégorie</label>
        <select id="productCategory" required>
          <option value="">Choisir une catégorie</option>
          <option value="m3u">M3U</option>
          <option value="code">Code</option>
          <option value="test">Test</option>
          <option value="vip">VIP</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Image du produit (URL)</label>
        <input type="url" id="productImage" placeholder="https://example.com/image.jpg">
      </div>
      
      <div class="form-group">
        <label>Description</label>
        <textarea id="productDescription" rows="3" placeholder="Description du produit..."></textarea>
      </div>
      
      <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px;">
        <button type="button" class="btnSecondary" id="cancelProduct">Annuler</button>
        <button type="submit" class="btnPrimary">Créer le produit</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Ajouter Utilisateur -->
<div class="modal" id="addUserModal">
  <div class="modalInner">
    <h3 style="margin-bottom: 20px;">Créer un utilisateur</h3>
    <form id="addUserForm">
      <div class="form-group">
        <label>Nom complet</label>
        <input type="text" id="userName" required placeholder="Ex: John Doe">
      </div>
      
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="userEmail" required placeholder="exemple@email.com">
      </div>
      
      <div class="form-group">
        <label>Mot de passe</label>
        <input type="password" id="userPassword" required placeholder="Mot de passe sécurisé">
      </div>
      
      <div class="form-group">
        <label>Type d'utilisateur</label>
        <select id="userRole" required>
          <option value="user">Utilisateur standard</option>
          <option value="test">Utilisateur test (12h)</option>
          <option value="admin">Administrateur</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Solde initial (MAD)</label>
        <input type="number" id="userBalance" value="0" min="0" step="0.01">
      </div>
      
      <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px;">
        <button type="button" class="btnSecondary" id="cancelUser">Annuler</button>
        <button type="submit" class="btnPrimary">Créer l'utilisateur</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Notifications -->
<div class="modal" id="notificationsModal">
  <div class="modalInner" style="max-width: 500px;">
    <h3 style="margin-bottom: 20px;">Notifications</h3>
    <div id="notificationsList" style="max-height: 400px; overflow-y: auto;">
      <!-- Notifications -->
    </div>
    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
      <button class="btnSecondary" id="clearNotifications">Tout effacer</button>
      <button class="btnPrimary" id="closeNotifications">Fermer</button>
    </div>
  </div>
</div>

<script>
// ========== DONNÉES ET STOCKAGE ==========
const defaultUsers = [
  {
    id: 1,
    name: "Administrateur",
    email: "admin@shop4panel.com",
    password: "admin123",
    role: "admin",
    balance: 5000,
    createdAt: new Date().toISOString(),
    isOnline: false
  },
  {
    id: 2,
    name: "Utilisateur Demo",
    email: "user@shop4panel.com",
    password: "user123",
    role: "user",
    balance: 500,
    createdAt: new Date().toISOString(),
    isOnline: false
  }
];

const defaultProducts = [
  {
    id: 1,
    name: "Abonnement M3U 12 mois",
    price: 350,
    stock: 50,
    category: "m3u",
    image: "",
    description: "Abonnement complet 12 mois avec tous les chaînes",
    sales: 45,
    createdAt: new Date().toISOString()
  },
  {
    id: 2,
    name: "Code VIP 6 mois",
    price: 250,
    stock: 100,
    category: "code",
    image: "",
    description: "Code d'accès VIP pour 6 mois",
    sales: 32,
    createdAt: new Date().toISOString()
  },
  {
    id: 3,
    name: "Test 24h",
    price: 0,
    stock: 999,
    category: "test",
    image: "",
    description: "Test gratuit 24 heures",
    sales: 128,
    createdAt: new Date().toISOString()
  }
];

// Fonctions de stockage
function save(key, val) {
  try {
    localStorage.setItem('s4p_pro_' + key, JSON.stringify(val));
  } catch(e) {
    console.warn('Erreur sauvegarde:', e);
  }
}

function load(key) {
  try {
    const v = localStorage.getItem('s4p_pro_' + key);
    return v ? JSON.parse(v) : null;
  } catch(e) {
    return null;
  }
}

// Initialisation des données
if (!load('users')) save('users', defaultUsers);
if (!load('products')) save('products', defaultProducts);
if (!load('transactions')) save('transactions', []);
if (!load('notifications')) save('notifications', []);

// ========== UTILITAIRES ==========
const el = id => document.getElementById(id);
const showPage = (pageId) => {
  document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
  el(pageId).classList.remove('hidden');
  
  // Mettre à jour le menu actif
  document.querySelectorAll('.menu .item').forEach(item => {
    item.classList.remove('active');
    if (item.dataset.page === pageId) {
      item.classList.add('active');
    }
  });
};

const openModal = (modalId) => {
  el(modalId).style.display = 'flex';
  document.body.style.overflow = 'hidden';
};

const closeModal = (modalId) => {
  el(modalId).style.display = 'none';
  document.body.style.overflow = 'auto';
};

// ========== GESTION DE L'AUTHENTIFICATION ==========
el('demoAdmin').addEventListener('click', () => {
  el('userType').value = 'admin';
  el('email').value = 'admin@shop4panel.com';
  el('password').value = 'admin123';
});

el('demoUser').addEventListener('click', () => {
  el('userType').value = 'user';
  el('email').value = 'user@shop4panel.com';
  el('password').value = 'user123';
});

el('loginForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const userType = el('userType').value;
  const email = el('email').value.trim();
  const password = el('password').value;
  
  if (!userType || !email || !password) {
    showError('Veuillez remplir tous les champs');
    return;
  }
  
  const users = load('users') || [];
  const user = users.find(u => u.email === email && u.password === password && u.role === userType);
  
  if (!user) {
    showError('Identifiants incorrects ou type d\'utilisateur invalide');
    return;
  }
  
  // Connexion réussie
  user.isOnline = true;
  user.lastLogin = new Date().toISOString();
  save('users', users);
  save('currentUser', user);
  
  el('loginView').style.display = 'none';
  el('app').style.display = 'block';
  initDashboard();
});

function showError(message) {
  const errEl = el('loginErr');
  errEl.textContent = message;
  errEl.style.display = 'block';
  setTimeout(() => errEl.style.display = 'none', 5000);
}

// ========== INITIALISATION DU DASHBOARD ==========
function initDashboard() {
  const user = load('currentUser');
  if (!user) return;
  
  // Mettre à jour l'interface utilisateur
  el('uName').textContent = user.name;
  el('uRole').textContent = user.role === 'admin' ? 'Administrateur' : 'Utilisateur';
  el('uAvatar').textContent = user.name.split(' ').map(n => n[0]).join('').slice(0, 2).toUpperCase();
  el('userBalance').textContent = user.balance.toFixed(2) + ' MAD';
  
  // Afficher/masquer les éléments admin
  if (user.role === 'admin') {
    el('usersMenu').style.display = 'block';
    el('adminStats').style.display = 'block';
  }
  
  // Charger les données
  loadProducts();
  loadUsers();
  updateStats();
  showPage('dashboard');
  
  // Initialiser le graphique
  initChart();
}

// ========== GESTION DES PRODUITS ==========
function loadProducts() {
  const products = load('products') || [];
  const grid = el('productsGrid');
  
  grid.innerHTML = products.map(product => `
    <div class="product-card">
      ${product.image ? `<img src="${product.image}" class="product-image" alt="${product.name}">` : 
        `<div class="product-image" style="display: flex; align-items: center; justify-content: center; background: var(--gradient-primary); color: white; font-size: 14px;">
          <i class="fa fa-box"></i>
        </div>`}
      <h3 style="margin: 0 0 10px 0;">${product.name}</h3>
      <div style="color: var(--muted); font-size: 14px; margin-bottom: 10px;">${product.category.toUpperCase()}</div>
      <div class="product-price">${product.price > 0 ? product.price.toFixed(2) + ' MAD' : 'GRATUIT'}</div>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
        <span class="badge ${product.stock > 10 ? 'badge-success' : product.stock > 0 ? 'badge-warning' : 'badge-danger'}">
          ${product.stock} en stock
        </span>
        <span style="font-size: 12px; color: var(--muted);">${product.sales || 0} ventes</span>
      </div>
      ${load('currentUser').role === 'admin' ? `
        <div style="display: flex; gap: 8px; margin-top: 15px;">
          <button class="btnSecondary" style="flex: 1; padding: 8px;" onclick="editProduct(${product.id})">
            <i class="fa fa-edit"></i>
          </button>
          <button class="btnSecondary" style="flex: 1; padding: 8px; background: #fee2e2; color: #dc2626; border-color: #dc2626;" onclick="deleteProduct(${product.id})">
            <i class="fa fa-trash"></i>
          </button>
        </div>
      ` : ''}
    </div>
  `).join('');
  
  el('totalProducts').textContent = products.length;
}

// Ajouter un produit
el('addProductBtn').addEventListener('click', () => openModal('addProductModal'));
el('cancelProduct').addEventListener('click', () => closeModal('addProductModal'));

el('addProductForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const products = load('products') || [];
  const newProduct = {
    id: Math.max(...products.map(p => p.id), 0) + 1,
    name: el('productName').value,
    price: parseFloat(el('productPrice').value),
    stock: parseInt(el('productStock').value),
    category: el('productCategory').value,
    image: el('productImage').value,
    description: el('productDescription').value,
    sales: 0,
    createdAt: new Date().toISOString()
  };
  
  products.push(newProduct);
  save('products', products);
  loadProducts();
  closeModal('addProductModal');
  this.reset();
  
  // Ajouter une notification
  addNotification('Produit ajouté', `Le produit "${newProduct.name}" a été créé avec succès`);
});

// ========== GESTION DES UTILISATEURS ==========
function loadUsers() {
  const users = load('users') || [];
  const table = el('usersTable');
  
  table.innerHTML = users.map(user => `
    <tr>
      <td>
        <div style="display: flex; align-items: center; gap: 10px;">
          <div style="width: 32px; height: 32px; border-radius: 8px; background: var(--gradient-secondary); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 600;">
            ${user.name.split(' ').map(n => n[0]).join('').slice(0, 2).toUpperCase()}
          </div>
          ${user.name}
        </div>
      </td>
      <td>${user.email}</td>
      <td>
        <span class="badge ${user.role === 'admin' ? 'badge-warning' : user.role === 'test' ? 'badge-success' : 'badge-success'}">
          ${user.role === 'admin' ? 'Admin' : user.role === 'test' ? 'Test 12h' : 'Utilisateur'}
        </span>
      </td>
      <td><strong>${user.balance.toFixed(2)} MAD</strong></td>
      <td>
        <span class="badge ${user.isOnline ? 'badge-success' : 'badge-danger'}">
          ${user.isOnline ? 'En ligne' : 'Hors ligne'}
        </span>
      </td>
      <td>
        <button class="btnSecondary" style="padding: 6px 12px; font-size: 12px;" onclick="editUser(${user.id})">
          <i class="fa fa-edit"></i>
        </button>
      </td>
    </tr>
  `).join('');
  
  el('totalUsers').textContent = users.length;
  el('onlineUsers').textContent = `${users.filter(u => u.isOnline).length} utilisateurs en ligne`;
}

// Ajouter un utilisateur
el('addUserBtn').addEventListener('click', () => openModal('addUserModal'));
el('cancelUser').addEventListener('click', () => closeModal('addUserModal'));

el('addUserForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const users = load('users') || [];
  const userData = {
    id: Math.max(...users.map(u => u.id), 0) + 1,
    name: el('userName').value,
    email: el('userEmail').value,
    password: el('userPassword').value,
    role: el('userRole').value,
    balance: parseFloat(el('userBalance').value) || 0,
    createdAt: new Date().toISOString(),
    isOnline: false
  };
  
  // Si c'est un utilisateur test, définir une date d'expiration
  if (userData.role === 'test') {
    const expiry = new Date();
    expiry.setHours(expiry.getHours() + 12);
    userData.expiresAt = expiry.toISOString();
  }
  
  users.push(userData);
  save('users', users);
  loadUsers();
  closeModal('addUserModal');
  this.reset();
  
  addNotification('Utilisateur créé', `L'utilisateur "${userData.name}" a été créé avec succès`);
});

// ========== STATISTIQUES ==========
function updateStats() {
  const user = load('currentUser');
  const products = load('products') || [];
  const users = load('users') || [];
  const transactions = load('transactions') || [];
  
  if (user) {
    el('userBalance').textContent = user.balance.toFixed(2) + ' MAD';
  }
  
  // Calculer les ventes du mois
  const currentMonth = new Date().getMonth();
  const monthlySales = transactions.filter(t => {
    const date = new Date(t.date);
    return date.getMonth() === currentMonth;
  }).length;
  
  el('monthlySales').textContent = monthlySales;
}

// ========== GRAPHIQUE ==========
function initChart() {
  const ctx = document.getElementById('salesChart').getContext('2d');
  const transactions = load('transactions') || [];
  
  // Données exemple pour le graphique
  const data = {
    labels: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'],
    datasets: [{
      label: 'Ventes',
      data: [12, 19, 8, 15, 12, 18, 10],
      borderColor: '#00bfa6',
      backgroundColor: 'rgba(0, 191, 166, 0.1)',
      tension: 0.4,
      fill: true
    }]
  };
  
  new Chart(ctx, {
    type: 'line',
    data: data,
    options: {
      responsive: true,
      plugins: {
        legend: {
          display: false
        }
      },
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
}

// ========== NOTIFICATIONS ==========
function addNotification(title, message) {
  const notifications = load('notifications') || [];
  notifications.unshift({
    id: Date.now(),
    title,
    message,
    date: new Date().toLocaleString(),
    read: false
  });
  save('notifications', notifications);
  updateNotifications();
}

function updateNotifications() {
  const notifications = load('notifications') || [];
  const unreadCount = notifications.filter(n => !n.read).length;
  
  el('notificationCount').textContent = unreadCount;
  
  const list = el('notificationsList');
  list.innerHTML = notifications.slice(0, 10).map(notif => `
    <div style="padding: 12px; border-bottom: 1px solid #f1f5f9; cursor: pointer; ${!notif.read ? 'background: #f0f9ff;' : ''}" 
         onclick="markNotificationRead(${notif.id})">
      <div style="font-weight: 600; color: var(--accent1);">${notif.title}</div>
      <div style="font-size: 14px; margin-top: 4px;">${notif.message}</div>
      <div style="font-size: 12px; color: var(--muted); margin-top: 4px;">${notif.date}</div>
    </div>
  `).join('');
}

function markNotificationRead(id) {
  const notifications = load('notifications') || [];
  const updated = notifications.map(n => n.id === id ? {...n, read: true} : n);
  save('notifications', updated);
  updateNotifications();
}

// Gestion des événements de notifications
el('notificationsBtn').addEventListener('click', () => openModal('notificationsModal'));
el('closeNotifications').addEventListener('click', () => closeModal('notificationsModal'));
el('clearNotifications').addEventListener('click', () => {
  save('notifications', []);
  updateNotifications();
});

// ========== NAVIGATION ET UI ==========
document.querySelectorAll('.menu .item').forEach(item => {
  item.addEventListener('click', () => {
    const page = item.dataset.page;
    const user = load('currentUser');
    
    // Vérifier les permissions
    if (page === 'users' && user.role !== 'admin') {
      addNotification('Accès refusé', 'Cette section est réservée aux administrateurs');
      return;
    }
    
    showPage(page);
    
    // Fermer le sidebar sur mobile
    if (window.innerWidth <= 1024) {
      el('sidebar').classList.remove('active');
    }
  });
});

el('menuToggle').addEventListener('click', () => {
  el('sidebar').classList.toggle('active');
});

el('logoutBtn').addEventListener('click', () => {
  const user = load('currentUser');
  if (user) {
    const users = load('users') || [];
    const updatedUsers = users.map(u => 
      u.id === user.id ? {...u, isOnline: false} : u
    );
    save('users', updatedUsers);
  }
  
  localStorage.removeItem('s4p_pro_currentUser');
  location.reload();
});

// ========== FONCTIONS ADMIN ==========
function editProduct(id) {
  const products = load('products') || [];
  const product = products.find(p => p.id === id);
  if (product) {
    // Remplir le formulaire avec les données du produit
    el('productName').value = product.name;
    el('productPrice').value = product.price;
    el('productStock').value = product.stock;
    el('productCategory').value = product.category;
    el('productImage').value = product.image;
    el('productDescription').value = product.description;
    
    openModal('addProductModal');
    // Changer le texte du bouton
    document.querySelector('#addProductForm button[type="submit"]').textContent = 'Modifier le produit';
  }
}

function deleteProduct(id) {
  if (confirm('Êtes-vous sûr de vouloir supprimer ce produit ?')) {
    const products = load('products') || [];
    const updatedProducts = products.filter(p => p.id !== id);
    save('products', updatedProducts);
    loadProducts();
    addNotification('Produit supprimé', 'Le produit a été supprimé avec succès');
  }
}

function editUser(id) {
  const users = load('users') || [];
  const user = users.find(u => u.id === id);
  if (user) {
    // Implémenter l'édition d'utilisateur
    addNotification('Édition', `Édition de l'utilisateur ${user.name}`);
  }
}

// ========== INITIALISATION ==========
document.addEventListener('DOMContentLoaded', function() {
  const currentUser = load('currentUser');
  if (currentUser) {
    el('loginView').style.display = 'none';
    el('app').style.display = 'block';
    initDashboard();
  }
  
  updateNotifications();
  
  // Fermer les modals en cliquant à l'extérieur
  document.querySelectorAll('.modal').forEach(modal => {
    modal.addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal(this.id);
      }
    });
  });
});

// Gestion du responsive
window.addEventListener('resize', function() {
  if (window.innerWidth > 1024) {
    el('sidebar').classList.remove('active');
  }
});
</script>
</body>
</html>
